name: Create Download Package

on:
  workflow_dispatch:

jobs:
  package-downloads:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Download latest Windows artifact
      uses: dawidd6/action-download-artifact@v3
      with:
        workflow: build-windows.yml
        name: SMIC_Portfolio_Analysis-Windows
        path: downloads/windows
        if_no_artifact_found: warn
        
    - name: Download latest macOS artifact
      uses: dawidd6/action-download-artifact@v3
      with:
        workflow: build-macos.yml
        name: SMIC_Portfolio_Analysis-macOS
        path: downloads/macos
        if_no_artifact_found: warn
        
    - name: Download latest Linux artifact
      uses: dawidd6/action-download-artifact@v3
      with:
        workflow: build-linux.yml
        name: SMIC_Portfolio_Analysis-Linux
        path: downloads/linux
        if_no_artifact_found: warn
        
    - name: Create organized folder structure
      run: |
        mkdir -p SMIC_Portfolio_Analysis/{windows,macos,linux}
        
        # Copy Windows
        if [ -f "downloads/windows/SMIC_Portfolio_Analysis.exe" ]; then
          cp downloads/windows/SMIC_Portfolio_Analysis.exe SMIC_Portfolio_Analysis/windows/
          echo "âœ… Windows: SMIC_Portfolio_Analysis/windows/SMIC_Portfolio_Analysis.exe"
        else
          echo "âš ï¸  Windows executable not found"
        fi
        
        # Copy macOS
        if [ -d "downloads/macos/SMIC_Portfolio_Analysis.app" ]; then
          cp -r downloads/macos/SMIC_Portfolio_Analysis.app SMIC_Portfolio_Analysis/macos/
          echo "âœ… macOS: SMIC_Portfolio_Analysis/macos/SMIC_Portfolio_Analysis.app"
        elif [ -f "downloads/macos/SMIC_Portfolio_Analysis" ]; then
          cp downloads/macos/SMIC_Portfolio_Analysis SMIC_Portfolio_Analysis/macos/
          chmod +x SMIC_Portfolio_Analysis/macos/SMIC_Portfolio_Analysis
          echo "âœ… macOS: SMIC_Portfolio_Analysis/macos/SMIC_Portfolio_Analysis"
        else
          echo "âš ï¸  macOS executable not found"
        fi
        
        # Copy Linux
        if [ -f "downloads/linux/SMIC_Portfolio_Analysis" ]; then
          cp downloads/linux/SMIC_Portfolio_Analysis SMIC_Portfolio_Analysis/linux/
          chmod +x SMIC_Portfolio_Analysis/linux/SMIC_Portfolio_Analysis
          echo "âœ… Linux: SMIC_Portfolio_Analysis/linux/SMIC_Portfolio_Analysis"
        else
          echo "âš ï¸  Linux executable not found"
        fi
        
        # Create README
        cat > SMIC_Portfolio_Analysis/README.md << 'EOF'
# SMIC Portfolio Analysis - Executables

## Quick Start

### Windows
ðŸ“ `windows/SMIC_Portfolio_Analysis.exe`
â†’ Double-click to run

### macOS  
ðŸ“ `macos/SMIC_Portfolio_Analysis.app` (or executable)
â†’ Right-click â†’ Open (first time)

### Linux
ðŸ“ `linux/SMIC_Portfolio_Analysis`
â†’ `chmod +x SMIC_Portfolio_Analysis && ./SMIC_Portfolio_Analysis`

## Requirements
- âœ… No Python needed
- âœ… Internet required (for charts)
- âœ… Creates data folder automatically

For more info: https://github.com/joel-saucedo/SMIC-Portfolio-Analysis
EOF
        
        # Create zip files
        echo ""
        echo "ðŸ“¦ Creating zip files..."
        
        # Individual zips
        if [ -f "SMIC_Portfolio_Analysis/windows/SMIC_Portfolio_Analysis.exe" ]; then
          cd SMIC_Portfolio_Analysis/windows
          zip -q ../../SMIC_Portfolio_Analysis-Windows.zip SMIC_Portfolio_Analysis.exe
          cd ../..
          echo "âœ… Created: SMIC_Portfolio_Analysis-Windows.zip"
        fi
        
        if [ -d "SMIC_Portfolio_Analysis/macos" ]; then
          cd SMIC_Portfolio_Analysis/macos
          if [ -d "SMIC_Portfolio_Analysis.app" ]; then
            zip -q -r ../../SMIC_Portfolio_Analysis-macOS.zip SMIC_Portfolio_Analysis.app
          elif [ -f "SMIC_Portfolio_Analysis" ]; then
            zip -q ../../SMIC_Portfolio_Analysis-macOS.zip SMIC_Portfolio_Analysis
          fi
          cd ../..
          echo "âœ… Created: SMIC_Portfolio_Analysis-macOS.zip"
        fi
        
        if [ -f "SMIC_Portfolio_Analysis/linux/SMIC_Portfolio_Analysis" ]; then
          cd SMIC_Portfolio_Analysis/linux
          zip -q ../../SMIC_Portfolio_Analysis-Linux.zip SMIC_Portfolio_Analysis
          cd ../..
          echo "âœ… Created: SMIC_Portfolio_Analysis-Linux.zip"
        fi
        
        # Combined zip
        zip -q -r SMIC_Portfolio_Analysis-All-Platforms.zip SMIC_Portfolio_Analysis/
        echo "âœ… Created: SMIC_Portfolio_Analysis-All-Platforms.zip"
        
        echo ""
        echo "ðŸ“‚ Folder structure:"
        tree SMIC_Portfolio_Analysis/ 2>/dev/null || find SMIC_Portfolio_Analysis/ -type f | head -20
        echo ""
        echo "ðŸ“¦ Zip files:"
        ls -lh *.zip 2>/dev/null || echo "No zip files created"
        
    - name: Upload organized package
      uses: actions/upload-artifact@v4
      with:
        name: SMIC_Portfolio_Analysis-Downloads
        path: |
          SMIC_Portfolio_Analysis/
          SMIC_Portfolio_Analysis-*.zip
        retention-days: 30
        if-no-files-found: error

